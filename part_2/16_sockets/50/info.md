

#### Рекомендации:
- Используйте заголовочные файлы для объявления функций и констант.
- Обрабатывайте ошибки выделения памяти и корректно освобождайте её.
- Используйте Wireshark для отладки сетевых приложений, особенно при работе с сокетами.

### 1. Изучение заголовков канального уровня

#### Теория о заголовках канального уровня

Канальный уровень (Data Link Layer) является вторым уровнем модели OSI. Он отвечает за передачу данных между узлами в одной локальной сети (LAN). Основные функции канального уровня включают:

- Физическую адресацию
- Управление доступом к среде передачи данных
- Обнаружение и исправление ошибок

#### MAC-адреса

MAC-адрес (Media Access Control address) — это уникальный идентификатор, присваиваемый сетевому интерфейсу для связи на физическом уровне сети. MAC-адреса используются для адресации устройств в локальной сети.

**Структура MAC-адреса:**
- MAC-адрес состоит из 48 бит (6 байт).
- Представляется в виде шести пар шестнадцатеричных цифр, разделенных двоеточиями или дефисами (например, 00:1A:2B:3C:4D:5E).

**Назначение MAC-адресов:**
- Первые 24 бита (3 байта) обозначают идентификатор производителя (OUI - Organizationally Unique Identifier).
- Последние 24 бита (3 байта) обозначают уникальный идентификатор устройства.

Пример MAC-адреса:
```
00:1A:2B:3C:4D:5E
```

#### Использование MAC-адресов

MAC-адреса используются для передачи данных в пределах одной локальной сети. Они отличаются от IP-адресов, которые используются для маршрутизации данных между различными сетями.

**Основные отличия MAC-адресов от IP-адресов:**
- **MAC-адреса** работают на канальном уровне, тогда как **IP-адреса** работают на сетевом уровне.
- **MAC-адреса** уникальны для каждого сетевого интерфейса, тогда как **IP-адреса** могут изменяться в зависимости от сети.

#### Пример использования MAC-адресов

Когда устройство в локальной сети хочет отправить данные другому устройству, оно использует MAC-адреса для адресации. Процесс выглядит следующим образом:

1. Устройство-отправитель создает Ethernet-кадр, включающий MAC-адреса источника и назначения.
2. Ethernet-кадр передается по сети.
3. Устройство-получатель принимает кадр, проверяет MAC-адрес назначения и, если он совпадает с его собственным MAC-адресом, обрабатывает кадр.

#### Пример Ethernet-кадра

Ethernet-кадр состоит из следующих полей:

- **Преамбула** (7 байт): используется для синхронизации.
- **SFD (Start Frame Delimiter)** (1 байт): указывает начало кадра.
- **MAC-адрес назначения** (6 байт): MAC-адрес устройства-получателя.
- **MAC-адрес источника** (6 байт): MAC-адрес устройства-отправителя.
- **Тип/Длина** (2 байта): указывает тип протокола верхнего уровня (например, IPv4) или длину данных.
- **Данные** (46-1500 байт): полезная нагрузка кадра.
- **Контрольная сумма кадра (FCS)** (4 байта): используется для обнаружения ошибок.

```
+------------+-----+---------------------+-------------------+-----------+--------+-----+
| Преамбула  | SFD | MAC-адрес назначения | MAC-адрес источника | Тип/Длина | Данные | FCS |
+------------+-----+---------------------+-------------------+-----------+--------+-----+
| 7 байт     | 1 байт | 6 байт              | 6 байт            | 2 байта   | 46-1500 байт | 4 байта |
+------------+-----+---------------------+-------------------+-----------+--------+-----+
```
### 2. Практическое использование Wireshark

Wireshark — это мощный инструмент для анализа сетевого трафика. Он позволяет захватывать и анализировать пакеты данных, проходящие через сеть. В этом разделе мы рассмотрим, как установить и использовать Wireshark для анализа сетевого трафика.

На железках юзать TSPDUMP


#### Захват сетевого трафика

1. **Выбор сетевого интерфейса**:
   - После запуска Wireshark вы увидите список доступных сетевых интерфейсов.
   - Выберите интерфейс, через который проходит интересующий вас трафик (например, Ethernet или Wi-Fi).

2. **Начало захвата трафика**:
   - Нажмите на кнопку "Start" рядом с выбранным интерфейсом для начала захвата трафика.
   - Wireshark начнет захватывать все пакеты, проходящие через выбранный интерфейс.

3. **Остановка захвата трафика**:
   - Нажмите на кнопку "Stop" (красный квадрат) в верхней части окна Wireshark для остановки захвата.

#### Использование фильтров

Wireshark позволяет использовать фильтры для отсеивания ненужного трафика и анализа интересующих пакетов. Фильтры можно применять как до начала захвата (capture filters), так и после (display filters).

1. **Capture Filters**:
   - Capture фильтры применяются до начала захвата и позволяют захватывать только определенные типы пакетов.
   - Пример: `tcp port 80` — захватывает только пакеты TCP, проходящие через порт 80.

2. **Display Filters**:
   - Display фильтры применяются после захвата и позволяют отображать только определенные типы пакетов.
   - Пример: `ip.addr == 192.168.1.1` — отображает только пакеты с указанным IP-адресом.

#### Примеры фильтров

- `tcp` — отображает только TCP-пакеты.
- `udp` — отображает только UDP-пакеты.
- `icmp` — отображает только ICMP-пакеты.
- `http` — отображает только HTTP-пакеты.
- `ip.addr == 192.168.1.1` — отображает пакеты с указанным IP-адресом.
- `tcp.port == 80` — отображает пакеты, проходящие через порт 80.

#### Анализ установления TCP-соединения (тройное рукопожатие)

Тройное рукопожатие (Three-way handshake) — это процесс установления TCP-соединения между клиентом и сервером. Он состоит из трех шагов:

1. **SYN**:
   - Клиент отправляет серверу пакет SYN (synchronize) для инициации соединения.
   - Пакет содержит начальный номер последовательности (Sequence Number).

2. **SYN-ACK**:
   - Сервер отвечает клиенту пакетом SYN-ACK (synchronize-acknowledge).
   - Пакет содержит номер последовательности сервера и подтверждение номера последовательности клиента (Acknowledgment Number).

3. **ACK**:
   - Клиент подтверждает соединение пакетом ACK (acknowledge).
   - Пакет содержит подтверждение номера последовательности сервера.

#### Пример анализа тройного рукопожатия в Wireshark

1. **Захват трафика**:
   - Начните захват трафика в Wireshark.
   - Инициируйте TCP-соединение (например, откройте веб-страницу в браузере).

2. **Применение фильтра**:
   - Примените фильтр `tcp` для отображения только TCP-пакетов.

3. **Поиск тройного рукопожатия**:
   - Найдите последовательность пакетов SYN, SYN-ACK и ACK.
   - Выделите эти пакеты и изучите их содержимое.

#### Визуализация тройного рукопожатия

```
Клиент                Сервер
  | SYN --------------> |
  | <-------------- SYN-ACK |
  | ACK --------------> |
```