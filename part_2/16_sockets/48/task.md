Из лекции 50 на ютубе


**Задание:**

Модифицировать существующее клиентское приложение, которое ранее заполняло только заголовок транспортного уровня (UDP), чтобы оно теперь также заполняло заголовок сетевого уровня (IP). Для этого необходимо:

1. **Создать RAW-сокет**:
   - Использовать функцию `setsockopt` для настройки сокета таким образом, чтобы он позволял заполнять заголовок IP.
   - Включить опцию `IP_HDRINCL`, чтобы можно было как отправлять, так и получать пакеты с заполненным заголовком IP.

2. **Формирование пакета**:
   - В начале буфера, отправляемого через сокет, необходимо разместить заголовок IP, за которым следует заголовок UDP и строка данных.
   - Заполнить поля заголовка IP:
     - **Версия и длина заголовка**: Установить значение 0x45 (версия 4, длина заголовка 20 байт).
     - **Общая длина**: Указать общую длину пакета, включая заголовки IP и UDP, а также данные. ()
     - **Идентификатор**: Установить в ноль (система заполнит автоматически).
     - **Флаги и смещение фрагмента**: Установить в ноль (без фрагментации).
     - **Время жизни (TTL)**: Установить максимальное значение (например, 255).
     - **Протокол**: Указать UDP (значение 17).
     - **Контрольная сумма заголовка**: Установить в ноль (система заполнит автоматически).
     - **IP-адрес источника и назначения**: Указать соответствующие адреса.

3. **Отправка и приём пакетов**:
   - Отправить сформированный пакет на сервер.
   - При получении пакета пропустить первые 20 байт (заголовок IP) и 8 байт (заголовок UDP), чтобы получить строку данных.
   - Проверить порт назначения в заголовке UDP, чтобы убедиться, что пакет предназначен для данного клиентского приложения.

4. **Обработка и вывод данных**:
   - Если порт назначения совпадает с ожидаемым, вывести полученную строку данных на экран.

**Цель**: Обеспечить корректное взаимодействие клиента с сервером, демонстрируя понимание структуры заголовков IP и UDP, а также механизмов их заполнения и обработки.